<!DOCTYPE HTML>
<html lang="">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Hexo">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->

    <meta name="keywords" content="">


    <meta name="description" content="Solr 安装1：安装 Tomcat，解压缩即可。
2：解压 solr。3：把 solr 下的 dist 目录 solr-4.10.3.war 部署到 Tomcat\webapps 下(去掉版本...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Hexo</title>


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header" style="background-image:url(http://snippet.shenliyang.com/img/banner.jpg)">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="John Doe">
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">Hexo</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>Home</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/前端/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/后端/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/工具/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="">
            
	            NO Title!
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/07/18</span>
        </span>
        
    
</div>
            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="Solr-安装"><a href="#Solr-安装" class="headerlink" title="Solr 安装"></a>Solr 安装</h2><p>1：安装 Tomcat，解压缩即可。</p>
<p>2：解压 solr。<br>3：把 solr 下的 dist 目录 solr-4.10.3.war 部署到 Tomcat\webapps 下(去掉版本号)。</p>
<pre><code>如果tomcat在运行时添加或删除war包webapp也会相应创建或删除网站目录，应当关闭tomcat后删除war包。
</code></pre><p>4：启动 Tomcat 解压缩 war 包<br>5：把solr下example/lib/ext 目录下的所有的 jar 包，添加到 solr 的工程中(\WEB-INF\lib<br>目录下)。<br>6：创建一个 solrhome 。solr 下的/example/solr 目录就是一个 solrhome。复制此目录<br>到 D 盘改名为 solrhome<br>7：关联 solr 及 solrhome。需要修改 solr 工程的 web.xml 文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">env-entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">env-entry-name</span>&gt;</span>solr/home<span class="tag">&lt;/<span class="name">env-entry-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">env-entry-value</span>&gt;</span>d:\solrhome<span class="tag">&lt;/<span class="name">env-entry-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">env-entry-type</span>&gt;</span>java.lang.String<span class="tag">&lt;/<span class="name">env-entry-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">env-entry</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>8：启动 Tomcat<br><a href="http://IP:8080/solr/" target="_blank" rel="noopener">http://IP:8080/solr/</a></p>
<h2 id="中文分析器-IK-Analyzer"><a href="#中文分析器-IK-Analyzer" class="headerlink" title="中文分析器 IK Analyzer"></a>中文分析器 IK Analyzer</h2><h3 id="IK-Analyzer-简介"><a href="#IK-Analyzer-简介" class="headerlink" title="IK Analyzer 简介"></a>IK Analyzer 简介</h3><p>IK Analyzer 是一个开源的，基亍 java 语言开发的轻量级的中文分词工具包。从 2006年 12 月推出 1.0 版开始， IKAnalyzer 已经推出了 4 个大版本。最初，它是以开源项目Luence 为应用主体的，结合词典分词和文法分析算法的中文分词组件。从 3.0 版本开始，IK 发展为面向 Java 的公用分词组件，独立亍 Lucene 项目，同时提供了对 Lucene 的默认优化实现。在 2012 版本中，IK 实现了简单的分词歧义排除算法，标志着 IK 分词器从单<br>纯的词典分词向模拟语义分词衍化</p>
<h3 id="IK-Analyzer-配置"><a href="#IK-Analyzer-配置" class="headerlink" title="IK Analyzer 配置"></a>IK Analyzer 配置</h3><p>步骤：<br>1、把 IKAnalyzer2012FF_u1.jar 添加到 solr 工程的 lib 目录下<br>2、创建 WEB-INF/classes 文件夹 把扩展词典、停用词词典、配置文件放到 solr 工程<br>的 WEB-INF/classes 目录下。<br>3、修改 Solrhome 的 schema.xml 文件，配置一个 FieldType，使用 IKAnalyzer</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>普通分词：<br><img src="https://raw.githubusercontent.com/cwayer/assets/master/1540125162662.png" alt="1540125162662"></p>
<h2 id="Solr域"><a href="#Solr域" class="headerlink" title="Solr域"></a>Solr域</h2><h3 id="配置域"><a href="#配置域" class="headerlink" title="配置域"></a>配置域</h3><p>域相当于数据库的表字段，用户存放数据，因此用户根据业务需要去定义相关的 Field<br>（域），一般来说，每一种对应着一种数据，用户对同一种数据进行相同的操作。<br>域的常用属性：<br> name：指定域的名称<br> type：指定域的类型<br> indexed：是否索引<br> stored：是否存储<br> required：是否必须<br> multiValued：是否多值</p>
<p>Solr将查询后需要显示内容都存进去，否则要Solr有何用。</p>
<p>每行field都是域</p>
<blockquote>
<p>这次demo出错：没有配置域造成注解无效</p>
</blockquote>
<p><strong>demo准备1：修改 solrhome 的 schema.xml 文件 设置业务系统 Field</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_goodsid"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_title"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_price"</span> <span class="attr">type</span>=<span class="string">"double"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_image"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_category"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_seller"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_brand"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>stored是否储存，required是否必填，indexed是否搜索，multiValue是否带多值，type=“text_ik”代表字段使用中文分词器，name值同前端显示的name值对应</p>
<p>一般不会使用它配好带域 而是使用自定义，根据需求定义</p>
<p>案例需要：</p>
<p>id、title、price、brand、seller、image、catagory、goodssid(商品spu id)</p>
<p>因为我们点进去产品需要sku id查询</p>
<p>分析是否需要搜索（indexed）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">id	SKU</span><br><span class="line">title	标题		Y</span><br><span class="line">price	价格		Y</span><br><span class="line">image	图片地址	N</span><br><span class="line">brand	品牌		Y</span><br><span class="line">seller	商家名		Y</span><br><span class="line">category	商品分类	Y</span><br><span class="line">goodsid	商品SPU	Y</span><br><span class="line"></span><br><span class="line">商品SPU有时候还是需要的 因此还是改成Y (true)</span><br></pre></td></tr></table></figure>
<h3 id="复制域"><a href="#复制域" class="headerlink" title="复制域"></a>复制域</h3><p>复合域：几个列在一次，多列组合</p>
<p>复制域逻辑上的整合，不需要stored，需要multiValue</p>
<p>source从哪拷贝    dest目标值</p>
<p>下列item_keywords就是几个copyField的复制域，一个相当于多个域</p>
<p><strong>demo准备2：修改 solrhome 的 schema.xml 文件 设置业务系统 Field</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"item_keywords"</span> <span class="attr">type</span>=<span class="string">"text_ik"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"item_title"</span> <span class="attr">dest</span>=<span class="string">"item_keywords"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"item_category"</span> <span class="attr">dest</span>=<span class="string">"item_keywords"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"item_seller"</span> <span class="attr">dest</span>=<span class="string">"item_keywords"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"item_brand"</span> <span class="attr">dest</span>=<span class="string">"item_keywords"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="动态域"><a href="#动态域" class="headerlink" title="动态域"></a>动态域</h3><p>如规格，配置(配置好后重新启动)：<br><img src="https://raw.githubusercontent.com/cwayer/assets/master/1540121287404.png" alt="1540121287404"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"item_spec_*"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="SpringDataSolr"><a href="#SpringDataSolr" class="headerlink" title="SpringDataSolr"></a>SpringDataSolr</h2><p>虽然支持任何编程语言的能力具有很大的市场价值，你可能感兴趣的问题是：我如何将Solr 的应用集成到 Spring 中？可以，Spring Data Solr 就是为了方便 Solr 的开发所研制的一个框架，其底层是对 SolrJ（官方 API）的封装。</p>
<p>官方类库 solrJ 原理：http请求与响应</p>
<p>SpringDataSolr 原理：就是对官方类库对封装</p>
<p>手动请求solr 手动处理响应httpClient</p>
<h3 id="搭建demo"><a href="#搭建demo" class="headerlink" title="搭建demo"></a>搭建demo</h3><p>创建 maven 工程，pom.xml 中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-solr<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 src/main/resources 下创建 applicationContext-solr.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:solr</span>=<span class="string">"http://www.springframework.org/schema/data/solr"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/data/solr </span></span></span><br><span class="line"><span class="tag"><span class="string">  		http://www.springframework.org/schema/data/solr/spring-solr-1.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- solr服务器地址 就是tomcat中solr地址 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">solr:solr-server</span> <span class="attr">id</span>=<span class="string">"solrServer"</span> <span class="attr">url</span>=<span class="string">"http://127.0.0.1:8080/solr"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">	<span class="comment">&lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"solrTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.solr.core.SolrTemplate"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 构造参数 构造器注入参数--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"solrServer"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Field-注解"><a href="#Field-注解" class="headerlink" title="@Field 注解"></a>@Field 注解</h3><p>创建 cn.itcast.pojo 包，将品优购的 TbItem 实体类拷入本工程 ,属性使用@Field 注解标识 。<br>如果属性与配置文件定义的域名称不一致，需要在注解中指定域名称。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TbItem</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">		<span class="meta">@Field</span> <span class="comment">// 由于默认solr里也是id，因此可以省略不写关联词</span></span><br><span class="line">		<span class="keyword">private</span> Long id;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_title"</span>)</span><br><span class="line">		<span class="keyword">private</span> String title;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_price"</span>)</span><br><span class="line">		<span class="keyword">private</span> BigDecimal price;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_image"</span>)</span><br><span class="line">		<span class="keyword">private</span> String image;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_goodsid"</span>)</span><br><span class="line">		<span class="keyword">private</span> Long goodsId;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_category"</span>)</span><br><span class="line">		<span class="keyword">private</span> String category;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_brand"</span>)</span><br><span class="line">		<span class="keyword">private</span> String brand;</span><br><span class="line">		<span class="meta">@Field</span>(<span class="string">"item_seller"</span>)</span><br><span class="line">		<span class="keyword">private</span> String seller;</span><br><span class="line">    	.......</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>创建测试类 TestTemplate.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:applicationContext-solr.xml"</span>)</span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTemplate</span> </span>&#123;</span><br><span class="line">        <span class="comment">//先注入solrTemplate</span></span><br><span class="line">		<span class="meta">@Autowired</span></span><br><span class="line">		<span class="keyword">private</span> SolrTemplate solrTemplate;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Test</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			TbItem item = <span class="keyword">new</span> TbItem();</span><br><span class="line">			item.setId(<span class="number">1L</span>);</span><br><span class="line">			item.setBrand(<span class="string">"华为"</span>);</span><br><span class="line">			item.setCategory(<span class="string">"手机"</span>);</span><br><span class="line">			item.setGoodsId(<span class="number">1L</span>);</span><br><span class="line">			item.setSeller(<span class="string">"华为 2 号专卖店"</span>);</span><br><span class="line">			item.setTitle(<span class="string">"华为 Mate9"</span>);</span><br><span class="line">			item.setPrice(<span class="keyword">new</span> BigDecimal(<span class="number">2000.01</span>));<span class="comment">// 实体类是浮点型</span></span><br><span class="line">			solrTemplate.saveBean(item);<span class="comment">// 保存</span></span><br><span class="line">			solrTemplate.commit(); <span class="comment">// 提交</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>测试前确保solr启动过的，第二次存id一样的情况就是修改</p>
<p>BigDecimal高精度：用来对超过16位有效位的数进行精确的运算。双精度浮点型变量double可以处理16位有效数。在实际应用中，需要对更大或者更小的数进行运算和处理。</p>
<h3 id="按主键查询删除"><a href="#按主键查询删除" class="headerlink" title="按主键查询删除"></a>按主键查询删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		TbItem item = solrTemplate.getById(<span class="number">1</span>, TbItem.class);</span><br><span class="line">		<span class="comment">// 根据主键查询 第二个参数自动转换类型</span></span><br><span class="line">		System.out.println(item.getTitle());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		solrTemplate.deleteById(<span class="string">"1"</span>); <span class="comment">// 根据主键删除</span></span><br><span class="line">		solrTemplate.commit();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p>首先循环插入 100 条测试数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;TbItem&gt; list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			TbItem item = <span class="keyword">new</span> TbItem();</span><br><span class="line">			item.setId(i + <span class="number">1L</span>);</span><br><span class="line">			item.setBrand(<span class="string">"华为"</span>);</span><br><span class="line">			item.setCategory(<span class="string">"手机"</span>);</span><br><span class="line">			item.setGoodsId(<span class="number">1L</span>);</span><br><span class="line">			item.setSeller(<span class="string">"华为 2 号专卖店"</span>);</span><br><span class="line">			item.setTitle(<span class="string">"华为 Mate"</span> + i);</span><br><span class="line">			item.setPrice(<span class="keyword">new</span> BigDecimal(<span class="number">2000</span> + i));</span><br><span class="line">			list.add(item);</span><br><span class="line">		&#125;</span><br><span class="line">		solrTemplate.saveBeans(list);</span><br><span class="line">		solrTemplate.commit();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>编写分页查询测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Query query = <span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>); </span><br><span class="line">        <span class="comment">//构建一个查询对象 *:*表示查询所有 前面*表示字段 后面*表示值  域名:值</span></span><br><span class="line">		query.setOffset(<span class="number">20</span>);<span class="comment">// 开始索引（默认 0）Offset英文含义便宜</span></span><br><span class="line">		query.setRows(<span class="number">20</span>);<span class="comment">// 每页记录数(默认 10)</span></span><br><span class="line">		ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query, TbItem.class);</span><br><span class="line">		System.out.println(<span class="string">"总记录数："</span> + page.getTotalElements());</span><br><span class="line">		List&lt;TbItem&gt; list = page.getContent();</span><br><span class="line">		showList(list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示记录数据</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showList</span><span class="params">(List&lt;TbItem&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (TbItem item : list) &#123;</span><br><span class="line">			System.out.println(item.getTitle() + item.getPrice());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>下图没做分页(注意：page.getContent()为List)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageQ</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	SimpleQuery query = <span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>);</span><br><span class="line">	ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query, TbItem.class);</span><br><span class="line">	<span class="keyword">for</span> (TbItem item : page.getContent()) &#123;</span><br><span class="line">		System.out.println(item.getTitle()+item.getBrand());</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而分页就是加上Query</p>
<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><p>Criteria 用于对条件的封装：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageQueryMutil</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Query query = <span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>);</span><br><span class="line">    Criteria criteria = <span class="keyword">new</span> Criteria(<span class="string">"item_title"</span>).contains(<span class="string">"2"</span>);</span><br><span class="line">    <span class="comment">//第一个括号要查询字段 第二个包含</span></span><br><span class="line">    criteria = criteria.and(<span class="string">"item_title"</span>).contains(<span class="string">"5"</span>);</span><br><span class="line">    <span class="comment">//and条件的拼接</span></span><br><span class="line">    query.addCriteria(criteria);</span><br><span class="line">    <span class="comment">//query.setOffset(20);//开始索引（默认 0）</span></span><br><span class="line">    <span class="comment">//query.setRows(20);//每页记录数(默认 10)</span></span><br><span class="line">    ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query, TbItem.class);</span><br><span class="line">    System.out.println(<span class="string">"总记录数："</span> + page.getTotalElements());</span><br><span class="line">    List&lt;TbItem&gt; list = page.getContent();</span><br><span class="line">    showList(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除全部数据"><a href="#删除全部数据" class="headerlink" title="删除全部数据"></a>删除全部数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Query query = <span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>); <span class="comment">//没有Criteria条件时候冒号星一定要写</span></span><br><span class="line">    solrTemplate.delete(query);</span><br><span class="line">    solrTemplate.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="品优购-批量数据导入"><a href="#品优购-批量数据导入" class="headerlink" title="品优购-批量数据导入"></a>品优购-批量数据导入</h2><p>编写专门的导入程序，将商品数据导入到 Solr 系统中，百度也可搜索到专用数据导入插件。</p>
<h3 id="工程搭建"><a href="#工程搭建" class="headerlink" title="工程搭建"></a>工程搭建</h3><p>（1）创建 pinyougou-solr-util（jar） ,引入 pinyougou-dao 以及 spring 相关依赖（找service里相关依赖）</p>
<pre><code>spring相关依赖从其他service里复制来即可
</code></pre><p>（2）创建 spring 配置文件applicationContext包扫描（复制来）内容是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.pinyougou.solrutil"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建 com.pinyougou.solrutil 包，创建类 SolrUtil ,实现商品数据的查询(已审核商品)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把普通pojo实例化到spring容器中 配置文件中也有配置</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrUtil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TbItemMapper itemMapper;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 导入商品数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importItemData</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        TbItemExample example = <span class="keyword">new</span> TbItemExample();</span><br><span class="line">        Criteria criteria = example.createCriteria();<span class="comment">//创建条件</span></span><br><span class="line">        criteria.andStatusEqualTo(<span class="string">"1"</span>);<span class="comment">//已审核</span></span><br><span class="line">        List&lt;TbItem&gt; itemList = itemMapper.selectByExample(example);</span><br><span class="line">        System.out.println(<span class="string">"===商品列表==="</span>);</span><br><span class="line">        <span class="keyword">for</span>(TbItem item : itemList)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(item.getTitle());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"===结束==="</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//main方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//用spring进行管理 先加载配置文件 常规查询</span></span><br><span class="line">        <span class="comment">//不用spring容器管理的不能用 @Autowired</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span></span><br><span class="line">        ClassPathXmlApplicationContext(<span class="string">"classpath*:spring/applicationContext*.xml"</span>);</span><br><span class="line">        <span class="comment">//第二个路径*扩大路径的范围 可以匹配其他模块里的文件</span></span><br><span class="line">        <span class="comment">//classpath*扫描jar包里的配置文件加 因为dao是jar的</span></span><br><span class="line">        SolrUtil solrUtil = (SolrUtil) context.getBean(<span class="string">"solrUtil"</span>);</span><br><span class="line">        solrUtil.importItemData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/cwayer/assets/master/1540107164643.png" alt="1540107113326"></p>
<p>（main方法不输出结果方法）上图这种要加log4j的依赖jar包</p>
<h3 id="数据导入-Solr-索引库"><a href="#数据导入-Solr-索引库" class="headerlink" title="数据导入 Solr 索引库"></a>数据导入 Solr 索引库</h3><h4 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h4><p>（1）将 demo 工程中添加了@Field 注解的实体类拷贝到 pinyougou-pojo 中会报错 此时导入依赖<br>（2）在 pinyougou-pojo 中引入依赖，然后install</p>
<p>为什么不用solrJ是因为以后项目要其他注解solrJ没有</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-solr<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="添加-Solr-配置文件"><a href="#添加-Solr-配置文件" class="headerlink" title="添加 Solr 配置文件"></a>添加 Solr 配置文件</h4><p>添加 applicationContext-solr.xml 到 spring 目录（demo里的配置文件直接复制到util中）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- solr 服务器地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">solr:solr-server</span> <span class="attr">id</span>=<span class="string">"solrServer"</span> <span class="attr">url</span>=<span class="string">"http://127.0.0.1:8080/solr"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- solr 模板，使用 solr 模板可对索引库进行 CRUD 的操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"solrTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.solr.core.SolrTemplate"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"solrServer"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="调用模板类导入-solr"><a href="#调用模板类导入-solr" class="headerlink" title="调用模板类导入 solr"></a>调用模板类导入 solr</h4><p>修改 pinyougou-solr-util 的 SolrUtil.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SolrTemplate solrTemplate;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 导入商品数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importItemData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TbItemExample example = <span class="keyword">new</span> TbItemExample();</span><br><span class="line">    Criteria criteria = example.createCriteria();</span><br><span class="line">    criteria.andStatusEqualTo(<span class="string">"1"</span>);<span class="comment">//已审核</span></span><br><span class="line">    List&lt;TbItem&gt; itemList = itemMapper.selectByExample(example);</span><br><span class="line">    System.out.println(<span class="string">"===商品列表==="</span>);</span><br><span class="line">    <span class="keyword">for</span>(TbItem item : itemList)</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(item.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line">    solrTemplate.saveBeans(itemList); <span class="comment">//批量导入</span></span><br><span class="line">    solrTemplate.commit();</span><br><span class="line">    System.out.println(<span class="string">"===结束==="</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="规格-导入动态域"><a href="#规格-导入动态域" class="headerlink" title="规格-导入动态域"></a>规格-导入动态域</h3><h4 id="Dynamic-注解"><a href="#Dynamic-注解" class="headerlink" title="@Dynamic 注解"></a>@Dynamic 注解</h4><p>修改 TbItem.java ，添加属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dynamic</span></span><br><span class="line"><span class="meta">@Field</span>(<span class="string">"item_spec_*"</span>)</span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String&gt; specMap;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getSpecMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> specMap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpecMap</span><span class="params">(Map&lt;String, String&gt; specMap)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.specMap = specMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="修改导入工具"><a href="#修改导入工具" class="headerlink" title="修改导入工具"></a>修改导入工具</h4><p>修改 pinyougou-solr-util 的 SolrUtil.java ,引入 fastJSON 依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 导入商品数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importItemData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TbItemExample example = <span class="keyword">new</span> TbItemExample();</span><br><span class="line">    Criteria criteria = example.createCriteria();</span><br><span class="line">    criteria.andStatusEqualTo(<span class="string">"1"</span>);<span class="comment">//已审核</span></span><br><span class="line">    List&lt;TbItem&gt; itemList = itemMapper.selectByExample(example);</span><br><span class="line">    System.out.println(<span class="string">"===商品列表==="</span>);</span><br><span class="line">    <span class="keyword">for</span>(TbItem item : itemList)</span><br><span class="line">    &#123;</span><br><span class="line">        Map specMap = JSON.parseObject(item.getSpec()); <span class="comment">//将 spec 字段中的 json 字符</span></span><br><span class="line">        串转换为 map</span><br><span class="line">        item.setSpecMap(specMap);<span class="comment">//给带注解的字段赋值</span></span><br><span class="line">        System.out.println(item.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line">    solrTemplate.saveBeans(itemList);</span><br><span class="line">    solrTemplate.commit();</span><br><span class="line">    System.out.println(<span class="string">"===结束==="</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="品优购-关键字搜索"><a href="#品优购-关键字搜索" class="headerlink" title="品优购-关键字搜索"></a>品优购-关键字搜索</h2><h3 id="后端服务接口层代码"><a href="#后端服务接口层代码" class="headerlink" title="后端服务接口层代码"></a>后端服务接口层代码</h3><h4 id="服务接口层"><a href="#服务接口层" class="headerlink" title="服务接口层"></a>服务接口层</h4><p>（1）创建 pinyougou-search-interface 模块（搜索服务接口 jar），依赖 pinyougou-pojo<br>（2）创建 com.pinyougou.search.service 包，创建业务接口，依赖pinyougou-search-interface</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ItemSearchService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 搜索</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> keywords</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">search</span><span class="params">(Map searchMap)</span></span>;</span><br><span class="line">    <span class="comment">//List不能满足需要，因为今后搜索业务更复杂 不止是搜索关键词 搜索词 多个且不确定</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务实现层"><a href="#服务实现层" class="headerlink" title="服务实现层"></a>服务实现层</h4><p>（1）创建 war 工程 pinyougou-search-service ，引入 pinyougou-search-interface spring<br>dubbox 等相关依赖（参加其它服务工程）Tomcat 运行端口 9004</p>
<p>从sellerservice中复制依赖，不需要dao的依赖，tomcat7端口9004</p>
<p>（2）添加 web.xml （参加其它服务工程）<br>（3）在 src/main/resources/spring 下 applicationContext-service.xml （参见其它服务工程）<br>dubbo 端口 20884（这是本机出去的端口）还需要修改扫描包package路径<br>（4）在 src/main/resources/spring 下创建 spring 配置文件 applicationContext-solr.xml（同<br>demo 工程）</p>
<p><strong>注意：不用配置spring data solr是因为依赖传递，该模块依赖接口，接口依赖pojo</strong></p>
<p><strong>因为pojo中需要加solr注解，因此solr jar包依赖写在这里面</strong></p>
<p>（5）编写服务实现类 ItemSearchServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(timeout = <span class="number">3000</span>) <span class="comment">//超时可以省略</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemSearchServiceImpl</span> <span class="keyword">implements</span> <span class="title">ItemSearchService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SolrTemplate solrTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">search</span><span class="params">(Map searchMap)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Query query = <span class="keyword">new</span> SimpleQuery();</span><br><span class="line">        <span class="comment">//也可以new SimpleQuery(*:*)下面有条件可以省略</span></span><br><span class="line">        <span class="comment">//添加查询条件</span></span><br><span class="line">        Criteria criteria = <span class="keyword">new</span> Criteria(<span class="string">"item_keywords"</span>).is(searchMap.get(<span class="string">"keywords"</span>));<span class="comment">//is这是通过分词的</span></span><br><span class="line">        <span class="comment">//item_keywords是复制域</span></span><br><span class="line">        query.addCriteria(criteria);</span><br><span class="line">        ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query, TbItem.class);</span><br><span class="line">        map.put(<span class="string">"rows"</span>, page.getContent());<span class="comment">//当前页数据给rows 设置大key为rows</span></span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="控制层"><a href="#控制层" class="headerlink" title="控制层"></a>控制层</h4><p>（1）创建 pinyougou-search-web 工程 ，引入依赖（参见其它 web 模块），tomcat 运行端<br>      口 9104<br>（2）添加 web.xml （参加其它 web 工程,springmvc.xml中改包名）<br>（3）添加配置文件 （内容参加其它 web 工程）<br>（4）创建包 com.pinyougou.search.controller 编写控制器类 </p>
<pre><code>在执行搜索时候有时候会造成超时，solr默认是1s，这时候可以在@Reference上设置超时

@Reference(timeout = 3000) 也可以在service上配置，代码如上，推荐放服务层

特殊情况：如果service、controller中都配置里不同超时时间，以controller为准
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/itemsearch"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemSearchController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> ItemSearchService itemSearchService;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/search"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">search</span><span class="params">(@RequestBody Map searchMap )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> itemSearchService.search(searchMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h4><h5 id="拷贝资源"><a href="#拷贝资源" class="headerlink" title="拷贝资源"></a>拷贝资源</h5><p><img src="https://raw.githubusercontent.com/cwayer/assets/master/1540112382461.png" alt="1540112382461"><br>web.xml配置欢迎页（可以配置多个 优先级从上到下）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>search.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>将 angularJS 拷贝到插件文件夹<br>拷贝 base.js 到 js 文件夹（都从其他模块中拷贝）</p>
<h5 id="服务层"><a href="#服务层" class="headerlink" title="服务层"></a>服务层</h5><p>pinyougou-search-web 工程创建 searchService.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//搜索服务层</span></span><br><span class="line">app.service(<span class="string">"searchService"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$http</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.search = <span class="function"><span class="keyword">function</span>(<span class="params">searchMap</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $http.post(<span class="string">'itemsearch/search.do'</span>, searchMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="控制层-1"><a href="#控制层-1" class="headerlink" title="控制层"></a>控制层</h5><p>pinyougou-search-web 工程 searchController.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">'searchController'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, searchService</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//搜索</span></span><br><span class="line">    $scope.search = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        searchService.search( $scope.searchMap ).success(</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $scope.resultMap = response; <span class="comment">//搜索返回的结果</span></span><br><span class="line">        &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h5><p>pinyougou-search-web 工程 search.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">引入 js</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"plugins/angularjs/angular.min.js"</span>&gt;</span><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/base.js"</span>&gt;</span><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/service/searchService.js"</span>&gt;</span><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/controller/searchController.js"</span>&gt;</span><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">指定控制器</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"pinyougou"</span> <span class="attr">ng-controller</span>=<span class="string">"searchController"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">绑定搜索框</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-append"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"autocomplete"</span> <span class="attr">ng-model</span>=<span class="string">"searchMap.keywords"</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"input-error input-xxlarge"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"sui-btn btn-xlarge btn-danger"</span> <span class="attr">ng-click</span>=<span class="string">"search()"</span> <span class="attr">type</span>=<span class="string">"button"</span>&gt;</span></span><br><span class="line">搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">循环显示数据</span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"yui3-u-1-5"</span> <span class="attr">ng-repeat</span>=<span class="string">"item in resultMap.rows"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"p-img"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"item.html"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;item.image&#125;&#125;"</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"price"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>￥<span class="tag">&lt;/<span class="name">em</span>&gt;</span> <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123;item.price&#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"attr"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">em</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cu"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">em</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>促<span class="tag">&lt;/<span class="name">span</span>&gt;</span>满一件可参加超值换购<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"commit"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"command"</span>&gt;</span>已有 2000 人评价<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"operate"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"success-cart.html"</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">class</span>=<span class="string">"sui-btn btn-bordered btn-danger"</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0);"</span> <span class="attr">class</span>=<span class="string">"sui-btn btn-bordered"</span>&gt;</span>对比<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0);"</span> <span class="attr">class</span>=<span class="string">"sui-btn btn-bordered"</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为什么用Result.rows? 接收的响应值就map，keywords是map里的key<br><img src="https://raw.githubusercontent.com/cwayer/assets/master/1540113765173.png" alt="1540113765173"></p>
<p>这里为什么用spring不用静态方法new(直接new出来不能直接注入)</p>
<p>因为我们要用dao模块，用原生方式比较麻烦</p>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2019/07/18/Day10_Search/" class="pre-post btn btn-default" title="">
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs"></span>
        </a>
    
    
        <a href="/2019/07/18/Day17_CROS/" class="next-post btn btn-default" title="">
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs"></span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
            appKey: 'erIpQac4azoCmgfBB7Dl9maa',
            placeholder: '说点什么吧',
            notify: false,
            verify: true,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: ''.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">Table of Contents</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Solr-安装"><span class="toc-text">Solr 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#中文分析器-IK-Analyzer"><span class="toc-text">中文分析器 IK Analyzer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IK-Analyzer-简介"><span class="toc-text">IK Analyzer 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IK-Analyzer-配置"><span class="toc-text">IK Analyzer 配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solr域"><span class="toc-text">Solr域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置域"><span class="toc-text">配置域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复制域"><span class="toc-text">复制域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态域"><span class="toc-text">动态域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringDataSolr"><span class="toc-text">SpringDataSolr</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建demo"><span class="toc-text">搭建demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field-注解"><span class="toc-text">@Field 注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#按主键查询删除"><span class="toc-text">按主键查询删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分页查询"><span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#条件查询"><span class="toc-text">条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除全部数据"><span class="toc-text">删除全部数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#品优购-批量数据导入"><span class="toc-text">品优购-批量数据导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#工程搭建"><span class="toc-text">工程搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据导入-Solr-索引库"><span class="toc-text">数据导入 Solr 索引库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实体类"><span class="toc-text">实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加-Solr-配置文件"><span class="toc-text">添加 Solr 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用模板类导入-solr"><span class="toc-text">调用模板类导入 solr</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#规格-导入动态域"><span class="toc-text">规格-导入动态域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dynamic-注解"><span class="toc-text">@Dynamic 注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改导入工具"><span class="toc-text">修改导入工具</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#品优购-关键字搜索"><span class="toc-text">品优购-关键字搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后端服务接口层代码"><span class="toc-text">后端服务接口层代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#服务接口层"><span class="toc-text">服务接口层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#服务实现层"><span class="toc-text">服务实现层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#控制层"><span class="toc-text">控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#前端代码"><span class="toc-text">前端代码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#拷贝资源"><span class="toc-text">拷贝资源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#服务层"><span class="toc-text">服务层</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#控制层-1"><span class="toc-text">控制层</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#页面"><span class="toc-text">页面</span></a></li></ol></li></ol></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2017
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>